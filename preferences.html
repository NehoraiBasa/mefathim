<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" content="width=device-width, initial-scale=1">
        <link href="https://fonts.googleapis.com/css?family=Alef|Varela+Round&display=swap" rel="stylesheet">
        <link rel="icon" type="image/png" href="img/icons/logo_icon.png">

        <meta name="viewport" content="width=device-width, initial-scale=1" charset="UTF-8">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
        <link rel="stylesheet" href="css/mefathim.css">
        <!-- <script src="js/navbar.js"></script> -->
        <script src="js/load.js"></script>
        <style>
            table{
                text-align: center;
            }
        </style>
        <title>שינוי העדפות</title>
    </head>
    <body dir="rtl" onload="check_params()">
        
        <nav id="nav" class="navbar navbar-expand-sm bg-light navbar-light"></nav>
        <div id="now_logged" style="padding-top: 50px;"></div>

        <center>
            <h3>העדפות</h3>
            <p id="ok"></p>
            
            <form action="scripts/preferences.py" method="post">
                <div id="result">
                </div>
                <table>
                    <tr><td>שם פרטי<input type="text" placeholder="שינוי שם פרטי" name="first_name" required></td>  
                    <td> תאריך לידה<input type="date" placeholder="תאריך לידה" name="birth_date" value=""></td></tr>
                    
                    <tr><td>שם משפחה<input type="text" placeholder=" שינוי שם משפחה" name="last_name"></td>
                    <td>עיר<input type="text" placeholder="עיר" name="city"></td></tr>
            
                    <tr><td> כינוי <input type="text" placeholder=" כינוי חדש" name="nick_name"></td>
                    <td>מדינה<input type="text" placeholder="הכנס מדינה ב3 אותיות (isr)" value="isr" name="country"></td></tr>

                    <tr><td>מגדר<select name="gender"><option value="1">זכר</option><option value="2">נקבה</option><option value="3">אחר</option></select></td>
                    <td>טלפון<input type="text" placeholder="טלפון" name="phone"></td></tr>
    
                    <tr><td><button type="submit" id="short_btn">בצע שינויים</button></td> 
                    <td><button class="short_btn" onclick="redirection()">בטל</button></td></tr>
                </table>
            </form>             
        </center>
        <p> גירסה:0.0008 &copy;</p>
        <script>
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function(){
                if(this.readyState == 4){
                    data_from_json = JSON.parse(this.responseText);
                    if(data_from_json.ok == true){
                        document.getElementsByName("first_name")[0].value = data_from_json.data.first_name;
                        document.getElementsByName("last_name")[0].value = data_from_json.data.last_name;
                        document.getElementsByName("nick_name")[0].value = data_from_json.data.nickname;
                        document.getElementsByName("gender")[0].value = data_from_json.data.gender;
                        document.getElementsByName("birth_date")[0].value = data_from_json.data.date_of_birth;
                        document.getElementsByName("city")[0].value = data_from_json.data.city;
                        document.getElementsByName("country")[0].value = data_from_json.data.country;
                        document.getElementsByName("phone")[0].value = data_from_json.data.phone_number;
                    }
                    else{
                        window.location = "login.html";
                    }
                }
            }
            xmlhttp.open("POST", "scripts/user_data.py", true);
            xmlhttp.send();

            function redirection(){
                window.location = "home_page.html"
            }

            function check_params(){
                var url_string = window.location.href;
                var url = new URL(url_string);
                if (url.searchParams.get("msg") == "1"){
                    document.getElementById('ok').innerHTML = "השינוי בוצע בהצלחה!!";
                }
            }
            buildnavbar();
            get_connected_users();
            setInterval(function(){ get_connected_users() }, 3000);
        </script>
    </body>
</html>
